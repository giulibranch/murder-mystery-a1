<!DOCTYPE html>
<html lang="en">
<head>
ย <meta charset="UTF-8">
ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย <title>Murder Mystery Game</title>
ย <script src="https://cdn.tailwindcss.com"></script>
ย <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
ย <div class="max-w-4xl mx-auto">
ย ย <h1 class="text-3xl font-bold text-center mb-4">๐ Mystery Game</h1>

ย ย <section class="mb-8 bg-white p-6 rounded shadow">
ย ย ย <h2 class="text-2xl font-semibold mb-2">The Story</h2>
ย ย ย <p class="text-gray-700">
ย ย ย ย Last night at **7:50 PM**, Mr. Blackwell was dead in the study room. Seven people were in the house. Ask questions, find clues, and guess who killed Mr. Blackwell.
ย ย ย </p>
ย ย </section>

ย ย <section class="mb-8">
ย ย ย <h2 class="text-2xl font-semibold mb-4">Suspects</h2>
ย ย ย <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="suspect-grid"></div>
ย ย </section>

ย ย <div id="question-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
ย ย ย <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
ย ย ย ย <h3 class="text-xl font-bold mb-4" id="modal-title">Ask a Question</h3>
ย ย ย ย <ul id="modal-word-bank" class="flex gap-2 flex-wrap p-4 bg-gray-100 rounded mb-4 min-h-[60px]"></ul>
ย ย ย ย <button onclick="checkModalQuestion()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Check</button>
ย ย ย ย <p id="modal-result" class="mt-2 font-bold"></p>
ย ย ย ย <button id="next-question-btn" onclick="nextModalQuestion()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hidden">Next</button>
ย ย ย ย <button onclick="closeModal()" class="mt-4 text-sm text-red-500 underline">Close</button>
ย ย ย </div>
ย ย </div>

ย ย <section class="mb-8">
ย ย ย <h2 class="text-2xl font-semibold mb-4">Killer's Timeline</h2>
ย ย ย <p class="mb-2 text-gray-600">Write what happened between 7:40 and 7:50:</p>
ย ย ย <form id="timeline-form" class="bg-white rounded-lg shadow p-4 space-y-4">
ย ย ย ย <div><label class="block font-semibold">7:40 PM</label><input type="text" class="w-full p-2 border border-gray-300 rounded" placeholder="What happened?" id="time1"></div>
ย ย ย ย <div><label class="block font-semibold">7:45 PM</label><input type="text" class="w-full p-2 border border-gray-300 rounded" placeholder="What happened?" id="time2"></div>
ย ย ย ย <div><label class="block font-semibold">7:47 PM</label><input type="text" class="w-full p-2 border border-gray-300 rounded" placeholder="What happened?" id="time3"></div>
ย ย ย ย <div><label class="block font-semibold">7:50 PM</label><input type="text" class="w-full p-2 border border-gray-300 rounded" placeholder="What happened?" id="time4"></div>
ย ย ย ย <button type="button" onclick="checkTimeline()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Check</button>
ย ย ย ย <p id="timeline-result" class="mt-2 font-bold"></p>
ย ย ย </form>
ย ย </section>

ย ย <section>
ย ย ย <h2 class="text-2xl font-semibold mb-4">Who Did It?</h2>
ย ย ย <p class="text-gray-600 mb-2">Choose the killer:</p>
ย ย ย <select id="killer-guess" class="w-full max-w-xs p-2 border border-gray-300 rounded">
ย ย ย ย <option value="">-- Choose --</option>
ย ย ย ย <option>Alice</option>
ย ย ย ย <option>Bob</option>
ย ย ย ย <option>Clara</option>
ย ย ย ย <option>David</option>
ย ย ย ย <option>Eva</option>
ย ย ย ย <option>Frank</option>
ย ย ย ย <option>Gina</option>
ย ย ย </select>
ย ย ย <button onclick="checkKillerGuess()" class="mt-4 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Submit</button>
ย ย ย <p id="killer-result" class="mt-2 font-bold"></p>
ย ย </section>
ย </div>

ย <script>
    // Variable global para almacenar la instancia de Sortable.js
    let currentSortable = null;
    
ย ย const suspects = [
ย ย ย {
ย ย ย ย name: 'Alice',
ย ย ย ย job: 'Cook',
ย ย ย ย responses: {
ย ย ย ย ย q1: 'At 7:40, I was cooking dinner in the kitchen.',
ย ย ย ย ย q2: 'At 7:45, I saw someone walking fast to the study room.',
ย ย ย ย ย q3: 'At 7:47, the lights went off, and I heard a scream.',
ย ย ย ย ย q4: 'At 7:50, I stayed in the kitchen.'
ย ย ย ย }
ย ย ย },
ย ย ย {
ย ย ย ย name: 'Bob',
ย ย ย ย job: 'Gardener',
ย ย ย ย responses: {
ย ย ย ย ย q1: 'I was in the garden.',
ย ย ย ย ย q2: 'At 7:45, I didn\'t see anyone, but I heard a loud noise.',
ย ย ย ย ย q3: 'At 7:47, I saw the lights go off, and someone screamed.',
ย ย ย ย ย q4: 'At 7:50, I went inside the house.'
ย ย ย ย }
ย ย ย },
ย ย ย {
ย ย ย ย name: 'Clara',
ย ย ย ย job: 'Teacher',
ย ย ย ย responses: {
ย ย ย ย ย q1: 'At 7:40, I was in the living room.',
ย ย ย ย ย q2: 'At 7:45, I went outside to talk to Bob.',
ย ย ย ย ย q3: 'At 7:47, the lights went off. I was scared.',
ย ย ย ย ย q4: 'At 7:50, I went to my room.'
ย ย ย ย }
ย ย ย },
ย ย ย {
ย ย ย ย name: 'David',
ย ย ย ย job: 'Driver',
ย ย ย ย responses: {
ย ย ย ย ย q1: 'At 7:40, I was cleaning the car in the garage.',
ย ย ย ย ย q2: 'At 7:45, I didn\'t see anyone, but I heard a loud noise inside.',
ย ย ย ย ย q3: 'At 7:47, the lighs went off.',
ย ย ย ย ย q4: 'At 7:50, I stayed outside.'
ย ย ย ย }
ย ย ย },
ย ย ย {
ย ย ย ย name: 'Eva',
ย ย ย ย job: 'Doctor',
ย ย ย ย responses: {
ย ย ย ย ย q1: 'At 7:40, I was reading a book in the hall.',
ย ย ย ย ย q2: 'At 7:45, I saw Alice cooking in the kitchen.',
ย ย ย ย ย q3: 'At 7:47, the lights went off, and I heard a scream in the study room.',
ย ย ย ย ย q4: 'At 7:50, I went to the study room, and I found Mr. Blackwell\'s body.'
ย ย ย ย }
ย ย ย },
ย ย ย {
ย ย ย ย name: 'Frank',
ย ย ย ย job: 'Musician',
ย ย ย ย responses: {
ย ย ย ย ย q1: 'At 7:40, I was playing the guitar in the music room.',
ย ย ย ย ย q2: 'At 7:45, I saw Bob alone in the garden.',
ย ย ย ย ย q3: 'At 7:47, the lights went off.',
ย ย ย ย ย q4: 'At 7:50, I stayed in the music room.'
ย ย ย ย }
ย ย ย },
ย ย ย {
ย ย ย ย name: 'Gina',
ย ย ย ย job: 'Librarian',
ย ย ย ย responses: {
ย ย ย ย ย q1: 'At 7:40, I was in the library.',
ย ย ย ย ย q2: 'At 7:45, I saw Clara near the study room.',
ย ย ย ย ย q3: 'At 7:47, I heard a scream after the lights went off.',
ย ย ย ย ย q4: 'At 7:50, I stayed in the library.'
ย ย ย ย }
ย ย ย }
ย ย ];

ย ย const allQuestions = [
ย ย ย 'Where were you at 7:40?',
ย ย ย 'What did you see at 7:45?',
ย ย ย 'What happened at 7:47?',
ย ย ย 'Where were you at 7:50?'
ย ย ];

ย ย let currentSuspect = null;
ย ย let currentQuestionIndex = 0;

ย ย const suspectGrid = document.getElementById('suspect-grid');
ย ย suspects.forEach((s) => {
ย ย ย const div = document.createElement('div');
ย ย ย div.className = 'bg-white p-4 rounded shadow text-center cursor-pointer hover:bg-blue-100';
ย ย ย div.onclick = () => openModal(s);
ย ย ย div.innerHTML = `<h3 class='font-bold text-lg'>${s.name}</h3><p class='text-sm text-gray-600'>${s.job}</p>`;
ย ย ย suspectGrid.appendChild(div);
ย ย });

ย ย function openModal(suspect) {
ย ย ย currentSuspect = suspect;
ย ย ย currentQuestionIndex = 0;
ย ย ย document.getElementById('modal-result').textContent = '';
ย ย ย loadModalQuestion();
ย ย ย document.getElementById('question-modal').classList.remove('hidden');
ย ย }

ย ย function loadModalQuestion() {
ย ย ย document.getElementById('modal-title').textContent = `Ask ${currentSuspect.name}`;
ย ย ย const bank = document.getElementById('modal-word-bank');
ย ย ย bank.innerHTML = '';
ย ย ย document.getElementById('next-question-btn').classList.add('hidden');

      // 1. DESTRUYE la instancia anterior de Sortable si existe.
      if (currentSortable) {
          currentSortable.destroy();
          currentSortable = null; 
      }

ย ย ย // Separamos el signo de interrogaciรณn de la รบltima palabra para que sea un bloque individual
ย ย ย const questionWithoutPunctuation = allQuestions[currentQuestionIndex].slice(0, -1);
ย ย ย let selectedWords = questionWithoutPunctuation.split(' ');
ย ย ย selectedWords.push('?'); // Agregamos el signo de interrogaciรณn como una palabra/bloque mรกs

ย ย ย shuffle(selectedWords);
ย ย ย selectedWords.forEach(word => {
ย ย ย ย const li = document.createElement('li');
ย ย ย ย li.textContent = word;
ย ย ย ย li.className = 'px-3 py-2 bg-blue-100 rounded cursor-move';
ย ย ย ย bank.appendChild(li);
ย ย ย });
      
      // 2. CREA la nueva instancia de Sortable y guรกrdala.
ย ย ย currentSortable = Sortable.create(bank, { animation: 150 });
ย ย }

ย ย function checkModalQuestion() {
ย ย ย const words = [...document.getElementById('modal-word-bank').children].map(li => li.textContent);
ย ย ย 
ย ย ย // Unimos las palabras y luego reemplazamos " ?" por "?" para corregir el formato.
ย ย ย let userQuestion = words.join(' ');
ย ย ย userQuestion = userQuestion.replace(' ?', '?').trim(); 

ย ย ย const expected = allQuestions[currentQuestionIndex].trim();
ย ย ย const result = document.getElementById('modal-result');

ย ย ย if (userQuestion === expected) { 
ย ย ย ย const answer = currentSuspect.responses[`q${currentQuestionIndex + 1}`];
ย ย ย ย result.textContent = `${currentSuspect.name} said: \"${answer}\"`;
ย ย ย ย document.getElementById('next-question-btn').classList.remove('hidden');
ย ย ย } else {
ย ย ย ย result.textContent = 'โ Try again.';
ย ย ย }
ย ย }


ย ย function nextModalQuestion() {
ย ย ย currentQuestionIndex++;
ย ย ย if (currentQuestionIndex >= allQuestions.length) {
ย ย ย ย closeModal();
ย ย ย } else {
ย ย ย ย document.getElementById('modal-result').textContent = '';
ย ย ย ย loadModalQuestion();
ย ย ย }
ย ย }

ย ย function closeModal() {
ย ย ย document.getElementById('question-modal').classList.add('hidden');
      // Destruye la instancia al cerrar el modal tambiรฉn
      if (currentSortable) {
          currentSortable.destroy();
          currentSortable = null;
      }
ย ย }

ย ย function checkTimeline() {
ย ย ย // Oraciones correctas actualizadas
ย ย ย const expected = [
ย ย ย ย 'Clara was in the living room.', 
ย ย ย ย 'Clara went to the study room.', 
ย ย ย ย 'Clara turned off the lights and killed Mr. Blackwell.', 
ย ย ย ย 'Eva found the body.'
ย ย ย ];

ย ย ย // Solo 4 entradas de tiempo (7:40, 7:45, 7:47, 7:50)
ย ย ย const userAnswers = [
ย ย ย ย document.getElementById('time1').value.trim(),
ย ย ย ย document.getElementById('time2').value.trim(),
ย ย ย ย document.getElementById('time3').value.trim(),
ย ย ย ย document.getElementById('time4').value.trim()
ย ย ย ];

ย ย ย const result = document.getElementById('timeline-result');
ย ย ย // Comprueba que la longitud de las respuestas sea la misma y que todas sean correctas
ย ย ย const isCorrect = userAnswers.length === expected.length && userAnswers.every((ans, i) => ans.toLowerCase() === expected[i].toLowerCase());

ย ย ย result.textContent = isCorrect ? 'โ Correct timeline!' : 'โ Try again.';
ย ย }

ย ย function checkKillerGuess() {
ย ย ย const guess = document.getElementById('killer-guess').value;
ย ย ย const result = document.getElementById('killer-result');
ย ย ย result.textContent = guess === 'Clara' ? `โ Correct! ${guess} is the killer.` : `โ No, ${guess} is not the killer.`;
ย ย }

ย ย function shuffle(arr) {
ย ย ย for (let i = arr.length - 1; i > 0; i--) {
ย ย ย ย const j = Math.floor(Math.random() * (i + 1));
ย ย ย ย [arr[i], arr[j]] = [arr[j], arr[i]];
ย ย ย }
ย ย }
ย </script>
</body>
</html>
